<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>CVE-2021-25367 Details | YayWebsiteYay (I suck at titles)</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="CVE-2021-25367 Details" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Sometimes I want to publish stuff unfiltered." />
<meta property="og:description" content="Sometimes I want to publish stuff unfiltered." />
<link rel="canonical" href="http://localhost:4000/cves/cve-2021-25367" />
<meta property="og:url" content="http://localhost:4000/cves/cve-2021-25367" />
<meta property="og:site_name" content="YayWebsiteYay (I suck at titles)" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CVE-2021-25367 Details" />
<script type="application/ld+json">
{"headline":"CVE-2021-25367 Details","@type":"WebPage","description":"Sometimes I want to publish stuff unfiltered.","url":"http://localhost:4000/cves/cve-2021-25367","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="YayWebsiteYay (I suck at titles)" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">YayWebsiteYay (I suck at titles)</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/published-research/">Published Research</a><a class="page-link" href="/cves/">My CVEs</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">CVE-2021-25367 Details</h1>
  </header>

  <div class="post-content">
    <h4 id="original-post-httpslabsf-securecomadvisoriessamsung-s20-access-external-storage-files">Original post: <a href="https://labs.f-secure.com/advisories/samsung-s20-access-external-storage-files/">https://labs.f-secure.com/advisories/samsung-s20-access-external-storage-files/</a></h4>

<table>
  <tbody>
    <tr>
      <td><strong>Product</strong></td>
      <td>Samsung phones with Samsung Notes (prior to version )</td>
    </tr>
    <tr>
      <td><strong>Severity</strong></td>
      <td>Low</td>
    </tr>
    <tr>
      <td><strong>CVE Reference</strong></td>
      <td>CVE-2021-25367</td>
    </tr>
    <tr>
      <td><strong>Type</strong></td>
      <td>Storage Security Bypass</td>
    </tr>
  </tbody>
</table>

<h2 id="description">Description</h2>

<p>F-Secure looked into exploiting the Samsung S20 device for Tokyo Pwn2Own 2020. An issue was discovered that would have allowed a rogue application to access any file on the external storage partition without the “External Storage” Android permissions.</p>

<h2 id="technical-details">Technical Details</h2>

<p>Samsung Notes (<code class="language-plaintext highlighter-rouge">com.samsung.android.app.notes</code>) has an exported content provider called <code class="language-plaintext highlighter-rouge">clipdatacontentprovider</code> that can be used by other applications to download files from the external storage. The issue is due to the class <code class="language-plaintext highlighter-rouge">com.samsung.android.support.senl.nt.base.framework.provider.ClipDataContentProvider</code> having two methods <code class="language-plaintext highlighter-rouge">onCreate</code> and <code class="language-plaintext highlighter-rouge">addRoot</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public boolean onCreate() {
    Context context = getContext();
    addRoot("external_files", new File(Environment.getExternalStorageDirectory(), "."));
    File[] externalFilesDirs = ContextCompat.getExternalFilesDirs(context, null);
    if (externalFilesDirs.length &lt;= 0) {
        return true;
    }
    addRoot("external-files-path", new File(externalFilesDirs[0], ShareCacheHelper.CACHE_PATH));
    return true;
}
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private void addRoot(String str, File file) {
    if (!TextUtils.isEmpty(str)) {
        try {
            mRoots.put(str, file.getCanonicalFile());
        } catch (IOException e) {
            throw new IllegalArgumentException("Failed to resolve canonical path for " + file, e);
        }
    } else {
        throw new IllegalArgumentException("Name must not be empty");
    }
}
</code></pre></div></div>

<p>The class relies on the hashMap <code class="language-plaintext highlighter-rouge">mRoots</code> to keep track of what the content provider’s root directories are. In the <code class="language-plaintext highlighter-rouge">onCreate</code> method, the external storage folder is added as an authorized root directory.</p>

<p>A rouge application installed on the same device can call this content provider to browse and download files from the External Storage area, bypassing the need to add <code class="language-plaintext highlighter-rouge">EXTERNAL_STORAGE_READ</code> or <code class="language-plaintext highlighter-rouge">EXTERNAL_STORAGE_WRITE</code> to the rouge application’s manifest. As an example, F-Secure utilized its Android testing application, Drozer, to exploit this issue. The screenshot below shows that Drozer did not have any additional Android permisions (right) and it could not read the file <code class="language-plaintext highlighter-rouge">/storage/emulated/0/yay.jpg</code> (top left). Meanwhile, the ADB user could read the file <code class="language-plaintext highlighter-rouge">/storage/emulated/0/yay.jpg</code> (bottom left):</p>

<p><img src="/assets/my_cves/cve-2021-25367_1.png" alt="yay" /></p>

<p>Drozer’s <code class="language-plaintext highlighter-rouge">app.provider.download</code> module can be used to dynamically craft a proper content provider call and communicate with the vulnerable content provider. The below output shows Drozer downloading the file <code class="language-plaintext highlighter-rouge">/storage/emulated/0/yay.jpg</code> from the external storage using the vulnerable content provider:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dz&gt; run app.provider.download content://com.samsung.android.app.notes.clipdatacontentprovider/external_files/yay.jpg /tmp/yay.jpg
Written 1932151 bytes

dz&gt; exit
root@324bda543ccd:/# sha1sum /tmp/yay.jpg
1e29865dc1b592b06f87cd7d569f93170daa74ed /tmp/yay.jpg
</code></pre></div></div>

<h2 id="remedial-action">Remedial Action</h2>

<p>Samsung has released Samsung Notes version 4.2.00.22 which fixes the issue outlined in this advisory. F-Secure recommends that users upgrade Samsung Notes to at least version 4.2.00.22.</p>

<h2 id="credits">Credits</h2>

<p>This issue was discovered by Ken Gannon.</p>

<h2 id="timeline">Timeline</h2>

<table>
  <tbody>
    <tr>
      <td><strong>Date</strong></td>
      <td><strong>Summary</strong></td>
    </tr>
    <tr>
      <td>02/11/2020</td>
      <td>Issue disclosed to Samsung Mobile Security</td>
    </tr>
    <tr>
      <td>02/11/2020</td>
      <td>Issue assigned to a Samsung Security Analyst</td>
    </tr>
    <tr>
      <td>16/12/2020</td>
      <td>Samsung confirms the vulnerability and rates it as a low risk issue</td>
    </tr>
    <tr>
      <td>12/01/2021</td>
      <td>Follow up sent to Samsung</td>
    </tr>
    <tr>
      <td>13/01/2021</td>
      <td>Samsung responded to follow up saying a patch is still being worked on</td>
    </tr>
    <tr>
      <td>09/02/2021</td>
      <td>Patch released, Samsung initiates process for bug bounty reward</td>
    </tr>
    <tr>
      <td>25/03/2021</td>
      <td>CVE Assigned</td>
    </tr>
    <tr>
      <td>26/03/2021</td>
      <td>Advisory Published</td>
    </tr>
  </tbody>
</table>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">YayWebsiteYay (I suck at titles)</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">YayWebsiteYay (I suck at titles)</li><li><a class="u-email" href="mailto:Fake_email_link">Fake_email_link</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/yogehi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">yogehi</span></a></li><li><a href="https://www.twitter.com/yogehi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">yogehi</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Sometimes I want to publish stuff unfiltered.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
